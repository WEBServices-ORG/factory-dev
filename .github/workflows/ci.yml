name: CI

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build-test:
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v4

      - name: Install mise
        run: brew install mise

      - name: Activate mise
        shell: bash
        run: |
          echo "$HOME/.local/share/mise/bin" >> "$GITHUB_PATH"
          echo "$HOME/.local/share/mise/shims" >> "$GITHUB_PATH"

      - name: Install toolchain (pinned)
        run: |
          # dev-cli can work with system swift, but we keep everything consistent
          mise install || true

      - name: Build (release)
        run: swift build -c release

      - name: Test --help
        run: .build/release/dev --help
